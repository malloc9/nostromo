class NostromoLifeSupport{constructor(dataSimulator){this.dataSimulator=dataSimulator,this.refreshInterval=null,this.refreshRate=2e3,this.isActive=!1,this.historicalData=[],this.maxHistoryLength=20,this.alertThresholds=this.initializeAlertThresholds(),this.zones=this.initializeZones(),this.init()}init(){console.log("Life Support system initialized")}initializeAlertThresholds(){return{oxygen:{critical:80,warning:90},co2:{warning:20,critical:30},pressure:{warningLow:.95,warningHigh:1.05,criticalLow:.9,criticalHigh:1.1},temperature:{warningLow:19,warningHigh:23,criticalLow:18,criticalHigh:24}}}initializeZones(){return[{id:"BRIDGE",name:"BRIDGE",priority:"HIGH"},{id:"ENGINE",name:"ENGINE ROOM",priority:"HIGH"},{id:"QUARTERS",name:"CREW QUARTERS",priority:"MEDIUM"},{id:"CARGO",name:"CARGO BAY",priority:"LOW"},{id:"MAINTENANCE",name:"MAINTENANCE",priority:"MEDIUM"},{id:"SCIENCE",name:"SCIENCE LAB",priority:"MEDIUM"}]}activate(){this.isActive=!0,this.render(),this.startRealTimeUpdates(),console.log("Life Support monitoring activated")}deactivate(){this.isActive=!1,this.stopRealTimeUpdates(),console.log("Life Support monitoring deactivated")}startRealTimeUpdates(){this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=setInterval(()=>{this.isActive&&this.updateData()},this.refreshRate)}stopRealTimeUpdates(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}render(){const lifeSupportScreen=document.getElementById("life-support-screen");if(!lifeSupportScreen)return void console.error("Life Support screen element not found");const screenContent=lifeSupportScreen.querySelector(".screen-content");screenContent?(screenContent.innerHTML=this.generateLifeSupportHTML(),this.updateData()):console.error("Life Support screen content not found")}generateLifeSupportHTML(){return`\n            <div class="life-support-container">\n                <div class="life-support-main-grid">\n                    <div class="life-support-col-left">\n                        \x3c!-- Environmental Status Overview --\x3e\n                        <div class="environmental-overview">\n                            <div class="section-header">ENVIRONMENTAL STATUS OVERVIEW</div>\n                            <div class="env-metrics-grid">\n                                <div class="metric-panel" id="oxygen-panel">\n                                    <div class="metric-header">\n                                        <span class="metric-title">OXYGEN LEVEL</span>\n                                        <span class="metric-status" id="oxygen-status">●</span>\n                                    </div>\n                                    <div class="metric-display">\n                                        <div class="metric-value" id="oxygen-value">--.--%</div>\n                                        <div class="metric-bar" id="oxygen-bar"></div>\n                                    </div>\n                                </div>\n\n                                <div class="metric-panel" id="co2-panel">\n                                    <div class="metric-header">\n                                        <span class="metric-title">CO2 LEVEL</span>\n                                        <span class="metric-status" id="co2-status">●</span>\n                                    </div>\n                                    <div class="metric-display">\n                                        <div class="metric-value" id="co2-value">-- PPM</div>\n                                        <div class="metric-bar" id="co2-bar"></div>\n                                    </div>\n                                </div>\n\n                                <div class="metric-panel" id="pressure-panel">\n                                    <div class="metric-header">\n                                        <span class="metric-title">PRESSURE</span>\n                                        <span class="metric-status" id="pressure-status">●</span>\n                                    </div>\n                                    <div class="metric-display">\n                                        <div class="metric-value" id="pressure-value">-.-- ATM</div>\n                                        <div class="metric-bar" id="pressure-bar"></div>\n                                    </div>\n                                </div>\n\n                                <div class="metric-panel" id="temperature-panel">\n                                    <div class="metric-header">\n                                        <span class="metric-title">TEMPERATURE</span>\n                                        <span class="metric-status" id="temperature-status">●</span>\n                                    </div>\n                                    <div class="metric-display">\n                                        <div class="metric-value" id="temperature-value">--.-°C</div>\n                                        <div class="metric-bar" id="temperature-bar"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Alert Panel --\x3e\n                        <div class="alert-section">\n                            <div class="section-header">\n                                SYSTEM ALERTS\n                                <span class="alert-count" id="alert-count">0</span>\n                            </div>\n                            <div class="alert-panel" id="alert-panel">\n                                <div class="no-alerts">NO ACTIVE ALERTS</div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="life-support-col-right">\n                        \x3c!-- Zone Status Grid --\x3e\n                        <div class="zone-status-section">\n                            <div class="section-header">ZONE ENVIRONMENTAL STATUS</div>\n                            <div class="zone-grid" id="zone-grid">\n                                ${this.generateZoneGridHTML()}\n                            </div>\n                        </div>\n\n                        \x3c!-- Trend Analysis --\x3e\n                        <div class="trend-section">\n                            <div class="section-header">ENVIRONMENTAL TRENDS</div>\n                            <div class="trend-display" id="trend-display">\n                                <div class="trend-chart" id="trend-chart">\n                                    <div class="chart-loading">COLLECTING TREND DATA...</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}generateZoneGridHTML(){return this.zones.map(zone=>`\n            <div class="zone-item" id="zone-${zone.id.toLowerCase()}">\n                <div class="zone-header">\n                    <span class="zone-name">${zone.name}</span>\n                    <span class="zone-priority priority-${zone.priority.toLowerCase()}">${zone.priority}</span>\n                </div>\n                <div class="zone-status">\n                    <div class="zone-metric">\n                        <span class="zone-label">O2:</span>\n                        <span class="zone-value" id="zone-${zone.id.toLowerCase()}-oxygen">--%</span>\n                    </div>\n                    <div class="zone-metric">\n                        <span class="zone-label">CO2:</span>\n                        <span class="zone-value" id="zone-${zone.id.toLowerCase()}-co2">--</span>\n                    </div>\n                    <div class="zone-metric">\n                        <span class="zone-label">TEMP:</span>\n                        <span class="zone-value" id="zone-${zone.id.toLowerCase()}-temp">--°C</span>\n                    </div>\n                    <div class="zone-indicator" id="zone-${zone.id.toLowerCase()}-indicator">●</div>\n                </div>\n            </div>\n        `).join("")}updateData(){if(!this.dataSimulator)return void console.warn("Data simulator not available");const lifeSupportData=this.dataSimulator.generateSystemStatus().lifeSupport;this.storeHistoricalData(lifeSupportData),this.updateEnvironmentalMetrics(lifeSupportData),this.updateZoneStatus(lifeSupportData),this.updateTrendDisplay(),this.updateAlerts(lifeSupportData)}storeHistoricalData(data){const timestamp=Date.now();this.historicalData.push({timestamp:timestamp,...data}),this.historicalData.length>this.maxHistoryLength&&this.historicalData.shift()}updateEnvironmentalMetrics(data){this.updateMetricPanel("oxygen",data.oxygen,"%",0,100),this.updateMetricPanel("co2",data.co2,"PPM",0,50),this.updateMetricPanel("pressure",data.pressure,"ATM",.8,1.2),this.updateMetricPanel("temperature",data.temperature,"°C",18,24)}updateMetricPanel(metric,value,unit,min,max){const valueElement=document.getElementById(`${metric}-value`),statusElement=document.getElementById(`${metric}-status`),barElement=document.getElementById(`${metric}-bar`);if(!valueElement||!statusElement||!barElement)return;const formattedValue="pressure"===metric?value.toFixed(2):value.toFixed(1);valueElement.textContent=`${formattedValue}${unit}`;const status=this.getMetricStatus(metric,value);statusElement.className=`metric-status ${status}`;const percentage=(value-min)/(max-min)*100;barElement.innerHTML=this.generateASCIIBar(percentage,status)}getMetricStatus(metric,value){const thresholds=this.alertThresholds[metric];switch(metric){case"oxygen":return value<thresholds.critical?"status-critical":value<thresholds.warning?"status-warning":"status-ok";case"co2":return value>thresholds.critical?"status-critical":value>thresholds.warning?"status-warning":"status-ok";case"pressure":case"temperature":return value<thresholds.criticalLow||value>thresholds.criticalHigh?"status-critical":value<thresholds.warningLow||value>thresholds.warningHigh?"status-warning":"status-ok";default:return"status-ok"}}generateASCIIBar(percentage,status){const filledBars=Math.round(percentage/100*20),emptyBars=20-filledBars;return`\n            <div class="ascii-bar ${status}">\n                <span class="bar-filled">${"█".repeat(filledBars)}</span><span class="bar-empty">${"░".repeat(emptyBars)}</span>\n                <span class="bar-percentage">${percentage.toFixed(1)}%</span>\n            </div>\n        `}updateZoneStatus(baseData){this.zones.forEach(zone=>{const zoneData=this.generateZoneVariation(baseData,zone),oxygenElement=document.getElementById(`zone-${zone.id.toLowerCase()}-oxygen`),co2Element=document.getElementById(`zone-${zone.id.toLowerCase()}-co2`),tempElement=document.getElementById(`zone-${zone.id.toLowerCase()}-temp`),indicatorElement=document.getElementById(`zone-${zone.id.toLowerCase()}-indicator`);if(oxygenElement&&(oxygenElement.textContent=`${zoneData.oxygen.toFixed(1)}%`),co2Element&&(co2Element.textContent=`${zoneData.co2.toFixed(1)}`),tempElement&&(tempElement.textContent=`${zoneData.temperature.toFixed(1)}°C`),indicatorElement){const worstStatus=this.getWorstZoneStatus(zoneData);indicatorElement.className=`zone-indicator ${worstStatus}`}})}generateZoneVariation(baseData,zone){const variation={BRIDGE:{oxygen:0,co2:-1,temperature:-.5},ENGINE:{oxygen:-2,co2:3,temperature:2},QUARTERS:{oxygen:1,co2:1,temperature:.5},CARGO:{oxygen:-1,co2:0,temperature:-1},MAINTENANCE:{oxygen:-1,co2:2,temperature:1},SCIENCE:{oxygen:0,co2:-.5,temperature:0}}[zone.id]||{oxygen:0,co2:0,temperature:0};return{oxygen:Math.max(0,Math.min(100,baseData.oxygen+variation.oxygen)),co2:Math.max(0,Math.min(50,baseData.co2+variation.co2)),temperature:Math.max(15,Math.min(30,baseData.temperature+variation.temperature)),pressure:baseData.pressure}}getWorstZoneStatus(zoneData){const statuses=[this.getMetricStatus("oxygen",zoneData.oxygen),this.getMetricStatus("co2",zoneData.co2),this.getMetricStatus("temperature",zoneData.temperature)];return statuses.includes("status-critical")?"status-critical":statuses.includes("status-warning")?"status-warning":"status-ok"}updateTrendDisplay(){const trendChart=document.getElementById("trend-chart");!trendChart||this.historicalData.length<3||(trendChart.innerHTML=this.generateTrendChart())}generateTrendChart(){if(this.historicalData.length<3)return'<div class="chart-loading">COLLECTING TREND DATA...</div>';const parameters=[{key:"oxygen",label:"OXYGEN",unit:"%"},{key:"co2",label:"CO2",unit:"ppm"},{key:"pressure",label:"PRESSURE",unit:"atm"},{key:"temperature",label:"TEMP",unit:"°C"}];let chart='<div class="trend-charts-list">';for(const param of parameters)chart+=this.generateParameterChart(param,4,40);return chart+="</div>",chart}generateParameterChart(param,chartHeight,chartWidth){const data=this.historicalData.map(d=>d[param.key]),minValue=Math.min(...data),range=Math.max(...data)-minValue||1,currentValue=data[data.length-1];let chart='<div class="parameter-chart">';chart+=`<div class="chart-subtitle">${param.label}</div>`,chart+='<div class="chart-display">';let chartLines="";for(let y=chartHeight-1;y>=0;y--){let line="";const threshold=minValue+range*y/(chartHeight-1);for(let x=0;x<Math.min(chartWidth,data.length);x++){const value=data[Math.max(0,data.length-chartWidth+x)];Math.abs(value-threshold)<range/(2*chartHeight)?line+="█":line+=value>threshold?" ":"░"}chartLines+=`<div class="chart-line">${line}</div>\n`}chart+=chartLines;const trend=this.calculateTrend(data),trendSymbol=trend>.1?"↗":trend<-.1?"↘":"→";return chart+=`<div class="chart-current">${currentValue.toFixed("temperature"===param.key?1:2)}${param.unit} ${trendSymbol}</div>\n`,chart+="</div>",chart+="</div>",chart}calculateTrend(data){if(data.length<3)return 0;const recent=data.slice(-3);return(recent[2]-recent[0])/2}updateAlerts(data){const alerts=this.generateAlerts(data),alertPanel=document.getElementById("alert-panel"),alertCount=document.getElementById("alert-count");alertPanel&&alertCount&&(alertCount.textContent=alerts.length.toString(),alertCount.className="alert-count "+(alerts.length>0?"has-alerts":""),0===alerts.length?alertPanel.innerHTML='<div class="no-alerts">NO ACTIVE ALERTS</div>':alertPanel.innerHTML=alerts.map(alert=>`\n                <div class="alert-item ${alert.severity}">\n                    <span class="alert-icon">⚠</span>\n                    <span class="alert-message">${alert.message}</span>\n                    <span class="alert-time">${alert.time}</span>\n                </div>\n            `).join(""))}generateAlerts(data){const alerts=[],currentTime=(new Date).toTimeString().substring(0,8);return data.oxygen<this.alertThresholds.oxygen.critical?alerts.push({severity:"alert-critical",message:`CRITICAL: OXYGEN LEVEL AT ${data.oxygen.toFixed(1)}% - IMMEDIATE ACTION REQUIRED`,time:currentTime}):data.oxygen<this.alertThresholds.oxygen.warning&&alerts.push({severity:"alert-warning",message:`WARNING: OXYGEN LEVEL AT ${data.oxygen.toFixed(1)}% - MONITOR CLOSELY`,time:currentTime}),data.co2>this.alertThresholds.co2.critical?alerts.push({severity:"alert-critical",message:`CRITICAL: CO2 LEVEL AT ${data.co2.toFixed(1)} PPM - VENTILATION REQUIRED`,time:currentTime}):data.co2>this.alertThresholds.co2.warning&&alerts.push({severity:"alert-warning",message:`WARNING: CO2 LEVEL AT ${data.co2.toFixed(1)} PPM - CHECK SCRUBBERS`,time:currentTime}),data.pressure<this.alertThresholds.pressure.criticalLow||data.pressure>this.alertThresholds.pressure.criticalHigh?alerts.push({severity:"alert-critical",message:`CRITICAL: PRESSURE AT ${data.pressure.toFixed(2)} ATM - HULL BREACH POSSIBLE`,time:currentTime}):(data.pressure<this.alertThresholds.pressure.warningLow||data.pressure>this.alertThresholds.pressure.warningHigh)&&alerts.push({severity:"alert-warning",message:`WARNING: PRESSURE AT ${data.pressure.toFixed(2)} ATM - CHECK SEALS`,time:currentTime}),data.temperature<this.alertThresholds.temperature.criticalLow||data.temperature>this.alertThresholds.temperature.criticalHigh?alerts.push({severity:"alert-critical",message:`CRITICAL: TEMPERATURE AT ${data.temperature.toFixed(1)}°C - LIFE SUPPORT FAILURE`,time:currentTime}):(data.temperature<this.alertThresholds.temperature.warningLow||data.temperature>this.alertThresholds.temperature.warningHigh)&&alerts.push({severity:"alert-warning",message:`WARNING: TEMPERATURE AT ${data.temperature.toFixed(1)}°C - CHECK CLIMATE CONTROL`,time:currentTime}),alerts}}"undefined"!=typeof module&&module.exports?module.exports=NostromoLifeSupport:window.NostromoLifeSupport=NostromoLifeSupport;