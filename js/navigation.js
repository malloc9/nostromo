class NostromoNavigation{constructor(dataSimulator){this.dataSimulator=dataSimulator,this.refreshInterval=null,this.refreshRate=2e3,this.isActive=!1,this.starMap=null,this.starMapSeed=Date.now(),this.init()}init(){console.log("Navigation system initialized")}activate(){this.isActive=!0,this.render(),this.startRealTimeUpdates(),this.setupResizeHandler(),console.log("Navigation system activated")}deactivate(){this.isActive=!1,this.stopRealTimeUpdates(),this.removeResizeHandler(),console.log("Navigation system deactivated")}startRealTimeUpdates(){this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=setInterval(()=>{this.isActive&&this.updateNavigationData()},this.refreshRate)}stopRealTimeUpdates(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}setupResizeHandler(){this.resizeHandler=()=>{this.isActive&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.regenerateStarMap()},300))},window.addEventListener("resize",this.resizeHandler)}removeResizeHandler(){this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null)}render(){const navigationScreen=document.getElementById("navigation-screen");if(!navigationScreen)return void console.error("Navigation screen element not found");const screenContent=navigationScreen.querySelector(".screen-content");screenContent?(screenContent.innerHTML=this.generateNavigationHTML(),this.setupStarMapClickHandlers(),this.updateNavigationData(),setTimeout(()=>{this.regenerateStarMap()},100)):console.error("Navigation screen content not found")}generateNavigationHTML(){return`\n            <div class="navigation-container">\n                \x3c!-- Ship Position and Status Section --\x3e\n                <div class="nav-status-section">\n                    <div class="section-header">SHIP POSITION & STATUS</div>\n                    <div class="position-grid">\n                        <div class="position-data">\n                            <div class="data-group">\n                                <div class="group-header">CURRENT POSITION</div>\n                                <div class="coordinate-display">\n                                    <div class="coord-row">\n                                        <span class="coord-label">X:</span>\n                                        <span class="coord-value" id="pos-x">--.--</span>\n                                    </div>\n                                    <div class="coord-row">\n                                        <span class="coord-label">Y:</span>\n                                        <span class="coord-value" id="pos-y">--.--</span>\n                                    </div>\n                                    <div class="coord-row">\n                                        <span class="coord-label">Z:</span>\n                                        <span class="coord-value" id="pos-z">--.--</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="data-group">\n                                <div class="group-header">NAVIGATION DATA</div>\n                                <div class="nav-data-display">\n                                    <div class="nav-row">\n                                        <span class="nav-label">HEADING:</span>\n                                        <span class="nav-value" id="nav-heading">---°</span>\n                                    </div>\n                                    <div class="nav-row">\n                                        <span class="nav-label">VELOCITY:</span>\n                                        <span class="nav-value" id="nav-velocity">-.--- C</span>\n                                    </div>\n                                    <div class="nav-row">\n                                        <span class="nav-label">DESTINATION:</span>\n                                        <span class="nav-value" id="nav-destination">----</span>\n                                    </div>\n                                    <div class="nav-row">\n                                        <span class="nav-label">ETA:</span>\n                                        <span class="nav-value" id="nav-eta">-- HOURS</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Star Map Section --\x3e\n                <div class="star-map-section">\n                    <div class="section-header">STELLAR CARTOGRAPHY</div>\n                    <div class="star-map-container">\n                        <div class="star-map" id="star-map">\n                            ${this.generateStarMap()}\n                        </div>\n                        <div class="map-controls">\n                            <div class="control-group">\n                                <span class="control-label">SCALE:</span>\n                                <span class="control-value">1:10000</span>\n                            </div>\n                            <div class="control-group">\n                                <span class="control-label">GRID:</span>\n                                <span class="control-value">ENABLED</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Navigation Status Bar --\x3e\n                <div class="nav-status-bar">\n                    <div class="status-item">\n                        <span class="status-label">NAV STATUS:</span>\n                        <span class="status-value" id="nav-system-status">OPERATIONAL</span>\n                    </div>\n                    <div class="status-item">\n                        <span class="status-label">LAST UPDATE:</span>\n                        <span class="status-value" id="nav-last-update">--:--:--</span>\n                    </div>\n                    <div class="status-item">\n                        <span class="status-label">DRIFT:</span>\n                        <span class="status-value" id="nav-drift">MINIMAL</span>\n                    </div>\n                </div>\n            </div>\n        `}calculateMapWidth(){const starMapElement=document.querySelector(".star-map");if(starMapElement){const containerWidth=starMapElement.clientWidth,charWidth=6,availableWidth=Math.floor((containerWidth-20)/charWidth);return Math.max(100,Math.min(250,availableWidth))}return 180}calculateMapHeight(){const starMapElement=document.querySelector(".star-map");if(starMapElement){const containerHeight=starMapElement.clientHeight,lineHeight=12,availableHeight=Math.floor((containerHeight-20)/lineHeight);return Math.max(25,Math.min(80,availableHeight))}return 45}generateStarMap(){const mapWidth=this.calculateMapWidth(),mapHeight=this.calculateMapHeight();let mapHTML='<pre class="star-field">';mapHTML+="    ";for(let x=0;x<mapWidth;x+=10)mapHTML+=`${String(x).padStart(10," ")}`;mapHTML+="\n",mapHTML+="    ";for(let x=0;x<mapWidth;x++)mapHTML+=x%10==0?"|":x%5==0?"+":"-";mapHTML+="\n";const starPositions=this.generateRandomStarPositions(mapWidth,mapHeight,this.starMapSeed);for(let y=0;y<mapHeight;y++){mapHTML+=`${String(10*y).padStart(3," ")} `;for(let x=0;x<mapWidth;x++){let char=" ";x%10==0?char="│":y%5==0&&x%5==0?char="┼":y%5==0&&(char="─");const starKey=`${x},${y}`;if(starPositions.has(starKey)&&" "===char){char=starPositions.get(starKey)}const shipX=Math.floor(mapWidth/2),shipY=Math.floor(mapHeight/2);x===shipX&&y===shipY?char='<span class="ship-position" id="ship-marker">◆</span>':" "!==char&&"│"!==char&&"┼"!==char&&"─"!==char&&(char=`<span class="star-point">${char}</span>`),mapHTML+=char}mapHTML+="\n"}return mapHTML+="</pre>",mapHTML}generateRandomStarPositions(width,height,baseSeed=12345){const starPositions=new Map,starTypes=["·","∘","*","✦","✧","⋆","✱","✯","⊙","☆","✶","✴","◦","●","○","◉"],nebulaTypes=["░","▒","▓"],seedRandom=seed=>{let x=1e4*Math.sin(seed+baseSeed);return x-Math.floor(x)};for(let y=0;y<height;y++)for(let x=0;x<width;x++){const seed2=97*x+163*y+17,seed3=113*x+179*y+89,random1=seedRandom(73*x+137*y+42),random2=seedRandom(seed2),random3=seedRandom(seed3),combinedRandom=(random1+random2+random3)/3;if(combinedRandom<.15){const starType=starTypes[Math.floor(random2*starTypes.length)];combinedRandom<.15+this.getClusterBonus(x,y,starPositions)&&starPositions.set(`${x},${y}`,starType)}else if(combinedRandom<.18){const nebulaType=nebulaTypes[Math.floor(random3*nebulaTypes.length)];starPositions.set(`${x},${y}`,`<span class="nebula-point">${nebulaType}</span>`)}}return starPositions}getClusterBonus(x,y,existingStars){let nearbyStars=0;for(let dy=-3;dy<=3;dy++)for(let dx=-3;dx<=3;dx++){if(0===dx&&0===dy)continue;const key=`${x+dx},${y+dy}`;existingStars.has(key)&&nearbyStars++}return.01*nearbyStars}updateNavigationData(){if(!this.dataSimulator)return void console.warn("Data simulator not available");const navData=this.dataSimulator.generateSystemStatus().navigation;this.updatePositionDisplay(navData),this.updateNavigationInfo(navData),this.updateShipPosition(navData),this.updateStatusBar()}updatePositionDisplay(navData){const posX=document.getElementById("pos-x"),posY=document.getElementById("pos-y"),posZ=document.getElementById("pos-z");posX&&(posX.textContent=navData.coordinates.x.toFixed(1)),posY&&(posY.textContent=navData.coordinates.y.toFixed(1)),posZ&&(posZ.textContent=navData.coordinates.z.toFixed(1))}updateNavigationInfo(navData){const heading=document.getElementById("nav-heading"),velocity=document.getElementById("nav-velocity"),destination=document.getElementById("nav-destination"),eta=document.getElementById("nav-eta");if(heading&&(heading.textContent=`${navData.heading.toFixed(1)}°`),velocity&&(velocity.textContent=`${navData.velocity.toFixed(3)} C`),destination&&(destination.textContent=navData.destination),eta&&navData.eta){const hoursToETA=Math.round((navData.eta.getTime()-Date.now())/36e5);eta.textContent=`${hoursToETA} HOURS`}}updateShipPosition(navData){const shipMarker=document.getElementById("ship-marker");if(!shipMarker)return;const mapWidth=this.calculateMapWidth(),mapHeight=this.calculateMapHeight(),mapCenterX=Math.floor(mapWidth/2),mapCenterY=Math.floor(mapHeight/2),mapX=Math.round(mapCenterX+navData.coordinates.x/400),mapY=Math.round(mapCenterY+navData.coordinates.y/400),clampedX=Math.max(0,Math.min(mapWidth-1,mapX)),clampedY=Math.max(0,Math.min(mapHeight-1,mapY));shipMarker.dataset.x=clampedX.toString(),shipMarker.dataset.y=clampedY.toString(),shipMarker.title=`NOSTROMO POSITION\nCoords: ${navData.coordinates.x.toFixed(1)}, ${navData.coordinates.y.toFixed(1)}, ${navData.coordinates.z.toFixed(1)}\nHeading: ${navData.heading.toFixed(1)}°\nVelocity: ${navData.velocity.toFixed(3)}c`}updateStatusBar(){const systemStatus=document.getElementById("nav-system-status"),lastUpdate=document.getElementById("nav-last-update"),drift=document.getElementById("nav-drift");if(systemStatus&&(systemStatus.textContent="OPERATIONAL",systemStatus.className="status-value status-ok"),lastUpdate){const now=new Date;lastUpdate.textContent=now.toTimeString().substring(0,8)}if(drift){const driftLevel=Math.random()<.1?"MODERATE":"MINIMAL";drift.textContent=driftLevel,drift.className="status-value "+("MINIMAL"===driftLevel?"status-ok":"status-warning")}}setupStarMapClickHandlers(){}calculateRoute(targetX,targetY){if(!this.dataSimulator)return;const systemData=this.dataSimulator.generateSystemStatus(),currentPos=systemData.navigation.coordinates,deltaX=targetX-currentPos.x,deltaY=targetY-currentPos.y,distance=Math.sqrt(deltaX*deltaX+deltaY*deltaY),bearing=Math.atan2(deltaY,deltaX)*(180/Math.PI);systemData.navigation.velocity;console.log(`Route calculated to ${targetX}, ${targetY}: ${distance.toFixed(1)} units, ${bearing.toFixed(1)}°`)}getCurrentNavigationData(){return this.dataSimulator?this.dataSimulator.generateSystemStatus().navigation:null}regenerateStarMap(seed=null){this.starMapSeed=null!==seed?seed:Date.now();const starMapElement=document.getElementById("star-map");starMapElement&&(starMapElement.innerHTML=this.generateStarMap(),this.setupStarMapClickHandlers())}validateNavigationCalculations(navData){const errors=[];return navData.coordinates&&"number"==typeof navData.coordinates.x||errors.push("Invalid X coordinate"),navData.coordinates&&"number"==typeof navData.coordinates.y||errors.push("Invalid Y coordinate"),navData.coordinates&&"number"==typeof navData.coordinates.z||errors.push("Invalid Z coordinate"),("number"!=typeof navData.heading||navData.heading<0||navData.heading>=360)&&errors.push("Invalid heading value"),("number"!=typeof navData.velocity||navData.velocity<0)&&errors.push("Invalid velocity value"),errors}}"undefined"!=typeof module&&module.exports?module.exports=NostromoNavigation:window.NostromoNavigation=NostromoNavigation;