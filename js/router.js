class NostromoRouter{constructor(){this.routes=new Map,this.currentRoute=null,this.defaultRoute="dashboard",this.transitionDuration=300,this.isTransitioning=!1,this.init()}init(){window.addEventListener("hashchange",()=>this.handleHashChange()),window.addEventListener("load",()=>this.handleInitialLoad()),this.registerDefaultRoutes(),console.log("Nostromo Router initialized")}registerDefaultRoutes(){this.addRoute("dashboard",{element:"dashboard-screen",title:"SHIP STATUS OVERVIEW",breadcrumb:"MAIN > DASHBOARD",hotkey:"F1",onEnter:()=>{window.dashboard&&window.dashboard.activate()},onExit:()=>{window.dashboard&&window.dashboard.deactivate()}}),this.addRoute("life-support",{element:"life-support-screen",title:"LIFE SUPPORT MONITORING",breadcrumb:"MAIN > LIFE SUPPORT",hotkey:"F2",onEnter:()=>{window.lifeSupport&&window.lifeSupport.activate()},onExit:()=>{window.lifeSupport&&window.lifeSupport.deactivate()}}),this.addRoute("navigation",{element:"navigation-screen",title:"NAVIGATION & POSITIONING",breadcrumb:"MAIN > NAVIGATION",hotkey:"F3",onEnter:()=>{window.navigation&&window.navigation.activate()},onExit:()=>{window.navigation&&window.navigation.deactivate()}}),this.addRoute("engineering",{element:"engineering-screen",title:"ENGINEERING & POWER",breadcrumb:"MAIN > ENGINEERING",hotkey:"F4",onEnter:()=>{window.engineering&&window.engineering.activate()},onExit:()=>{window.engineering&&window.engineering.deactivate()}}),this.addRoute("crew",{element:"crew-screen",title:"CREW MONITORING",breadcrumb:"MAIN > CREW",hotkey:"F5",onEnter:()=>{window.crew&&window.crew.activate()},onExit:()=>{window.crew&&window.crew.deactivate()}})}addRoute(path,config){this.routes.set(path,{path:path,element:config.element,title:config.title||path.toUpperCase(),breadcrumb:config.breadcrumb||`MAIN > ${path.toUpperCase()}`,hotkey:config.hotkey||null,onEnter:config.onEnter||null,onExit:config.onExit||null})}getCurrentHash(){return window.location.hash.slice(1)||this.defaultRoute}setHash(path){path!==this.getCurrentHash()&&(window.location.hash=path)}handleInitialLoad(){const hash=this.getCurrentHash(),bootScreen=document.getElementById("boot-screen");bootScreen&&bootScreen.classList.contains("active")||this.navigateTo(hash,!1)}handleHashChange(){const newRoute=this.getCurrentHash();this.navigateTo(newRoute,!0)}async navigateTo(path,animate=!0){if(this.isTransitioning)return!1;if(!this.routes.has(path))return console.warn(`Route '${path}' not found, redirecting to default`),window.audioManager&&window.audioManager.playError(),this.setHash(this.defaultRoute),!1;const route=this.routes.get(path),previousRoute=this.currentRoute;if(this.currentRoute===path)return!0;this.isTransitioning=!0;try{if(previousRoute&&this.routes.has(previousRoute)){const prevRoute=this.routes.get(previousRoute);prevRoute.onExit&&await prevRoute.onExit()}return animate?await this.performTransition(route):this.switchToScreen(route),this.currentRoute=path,this.updateNavigation(path),route.onEnter&&await route.onEnter(),this.dispatchRouteChangeEvent(path,previousRoute),window.audioManager&&null!==previousRoute&&window.audioManager.playConfirm(),console.log(`Navigated to: ${path}`),!0}catch(error){return console.error("Navigation error:",error),!1}finally{this.isTransitioning=!1}}async performTransition(route){const currentScreen=document.querySelector(".screen.active"),targetScreen=document.getElementById(route.element);if(!targetScreen)throw new Error(`Screen element '${route.element}' not found`);currentScreen&&currentScreen.classList.add("screen-exit"),targetScreen.classList.add("screen-enter"),currentScreen&&(await this.wait(this.transitionDuration/2),currentScreen.classList.remove("active","screen-exit")),targetScreen.classList.add("active"),await this.wait(this.transitionDuration/2),targetScreen.classList.remove("screen-enter")}switchToScreen(route){document.querySelectorAll(".screen").forEach(screen=>{screen.classList.remove("active")});const targetScreen=document.getElementById(route.element);targetScreen&&targetScreen.classList.add("active")}updateNavigation(path){document.querySelectorAll(".nav-item[data-screen]").forEach(item=>{item.classList.remove("active"),item.dataset.screen===path&&item.classList.add("active")});const route=this.routes.get(path);route&&route.title&&(document.title=`NOSTROMO - ${route.title}`)}dispatchRouteChangeEvent(newRoute,previousRoute){const event=new CustomEvent("routechange",{detail:{newRoute:newRoute,previousRoute:previousRoute,timestamp:Date.now()}});window.dispatchEvent(event)}wait(ms){return new Promise(resolve=>setTimeout(resolve,ms))}goTo(path){this.setHash(path)}goBack(){window.history.back()}getCurrentRoute(){return this.currentRoute}getRouteInfo(path){return this.routes.get(path)}getAllRoutes(){return Array.from(this.routes.keys())}completeBootSequence(){if(window.bootSequence)return window.bootSequence.completeBootSequence();const bootScreen=document.getElementById("boot-screen");return!(!bootScreen||!bootScreen.classList.contains("active"))&&(bootScreen.classList.remove("active"),this.navigateTo(this.defaultRoute,!0),!0)}async navigateWithTransition(path,showTransition=!0){if(this.isTransitioning)return!1;if(!this.routes.get(path))return console.warn(`Route '${path}' not found`),!1;if(showTransition&&window.bootSequence&&this.currentRoute){const currentRouteName=this.currentRoute.replace("-"," "),newRouteName=path.replace("-"," ");await window.bootSequence.showTransitionMessage(currentRouteName,newRouteName)}return await this.navigateTo(path,!0)}handleHotkey(key){for(const[path,route]of this.routes)if(route.hotkey===key)return this.goTo(path),!0;return!1}}window.NostromoRouter=NostromoRouter;