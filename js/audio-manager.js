class NostromoAudioManager{constructor(){this.isEnabled=!0,this.isMuted=!1,this.masterVolume=.7,this.ambientVolume=.3,this.effectsVolume=.5,this.audioContext=null,this.masterGainNode=null,this.ambientGainNode=null,this.effectsGainNode=null,this.ambientSources=new Map,this.effectSources=new Map,this.loadedSounds=new Map,this.currentAmbientTrack=null,this.isInitialized=!1,this.init()}async init(){try{await this.initializeAudioContext(),this.createAudioNodes(),await this.loadSoundEffects(),this.startAmbientAudio(),this.setupAudioControls(),this.isInitialized=!0,console.log("Nostromo Audio Manager initialized")}catch(error){console.warn("Audio initialization failed:",error),this.isEnabled=!1}}async initializeAudioContext(){this.audioContext=new(window.AudioContext||window.webkitAudioContext),"suspended"===this.audioContext.state&&(document.addEventListener("click",this.resumeAudioContext.bind(this),{once:!0}),document.addEventListener("keydown",this.resumeAudioContext.bind(this),{once:!0}))}async resumeAudioContext(){this.audioContext&&"suspended"===this.audioContext.state&&(await this.audioContext.resume(),console.log("Audio context resumed"))}createAudioNodes(){this.audioContext&&(this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.gain.value=this.masterVolume,this.masterGainNode.connect(this.audioContext.destination),this.ambientGainNode=this.audioContext.createGain(),this.ambientGainNode.gain.value=this.ambientVolume,this.ambientGainNode.connect(this.masterGainNode),this.effectsGainNode=this.audioContext.createGain(),this.effectsGainNode.gain.value=this.effectsVolume,this.effectsGainNode.connect(this.masterGainNode))}async loadSoundEffects(){const soundEffects={keypress:this.generateKeypressSound(),beep:this.generateBeepSound(),alert:this.generateAlertSound(),error:this.generateErrorSound(),confirm:this.generateConfirmSound(),navigation:this.generateNavigationSound(),startup:this.generateStartupSound(),shutdown:this.generateShutdownSound(),"data-update":this.generateDataUpdateSound(),warning:this.generateWarningSound(),critical:this.generateCriticalSound(),"ship-hum":this.generateShipHumSound(),"computer-processing":this.generateComputerProcessingSound(),ventilation:this.generateVentilationSound(),"tape-chatter":this.generateTapeChatterSound()};for(const[name,soundData]of Object.entries(soundEffects))try{this.loadedSounds.set(name,soundData)}catch(error){console.warn(`Failed to load sound effect: ${name}`,error)}}generateKeypressSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain(),filter=context.createBiquadFilter(),bufferSize=.05*context.sampleRate,buffer=context.createBuffer(1,bufferSize,context.sampleRate),data=buffer.getChannelData(0);for(let i=0;i<bufferSize;i++)data[i]=2*Math.random()-1;const noise=context.createBufferSource();noise.buffer=buffer;const noiseGain=context.createGain(),noiseFilter=context.createBiquadFilter();return noiseFilter.type="bandpass",noiseFilter.frequency.value=2500,noiseFilter.Q.value=1,noiseGain.gain.setValueAtTime(.4,context.currentTime),noiseGain.gain.exponentialRampToValueAtTime(.01,context.currentTime+.03),noise.connect(noiseFilter),noiseFilter.connect(noiseGain),noiseGain.connect(destination),noise.start(context.currentTime),oscillator.type="square",oscillator.frequency.setValueAtTime(150,context.currentTime),oscillator.frequency.exponentialRampToValueAtTime(40,context.currentTime+.05),filter.type="lowpass",filter.frequency.setValueAtTime(400,context.currentTime),gainNode.gain.setValueAtTime(.3,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.05),oscillator.connect(filter),filter.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+.05),{oscillator:oscillator,gainNode:gainNode,filter:filter}}}}generateBeepSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="sine",oscillator.frequency.setValueAtTime(1e3,context.currentTime),gainNode.gain.setValueAtTime(.2,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.2),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+.2),{oscillator:oscillator,gainNode:gainNode}}}}generateAlertSound(){return{type:"generated",generator:(context,destination)=>{const oscillator1=context.createOscillator(),oscillator2=context.createOscillator(),gainNode=context.createGain();return oscillator1.type="sawtooth",oscillator1.frequency.setValueAtTime(440,context.currentTime),oscillator1.frequency.setValueAtTime(880,context.currentTime+.1),oscillator1.frequency.setValueAtTime(440,context.currentTime+.2),oscillator2.type="sine",oscillator2.frequency.setValueAtTime(220,context.currentTime),gainNode.gain.setValueAtTime(.3,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.5),oscillator1.connect(gainNode),oscillator2.connect(gainNode),gainNode.connect(destination),oscillator1.start(context.currentTime),oscillator2.start(context.currentTime),oscillator1.stop(context.currentTime+.5),oscillator2.stop(context.currentTime+.5),{oscillator1:oscillator1,oscillator2:oscillator2,gainNode:gainNode}}}}generateErrorSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="sawtooth",oscillator.frequency.setValueAtTime(200,context.currentTime),oscillator.frequency.exponentialRampToValueAtTime(100,context.currentTime+.3),gainNode.gain.setValueAtTime(.4,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.3),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+.3),{oscillator:oscillator,gainNode:gainNode}}}}generateConfirmSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="sine",oscillator.frequency.setValueAtTime(600,context.currentTime),oscillator.frequency.setValueAtTime(800,context.currentTime+.1),gainNode.gain.setValueAtTime(.2,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.2),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+.2),{oscillator:oscillator,gainNode:gainNode}}}}generateNavigationSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="triangle",oscillator.frequency.setValueAtTime(400,context.currentTime),oscillator.frequency.setValueAtTime(600,context.currentTime+.05),oscillator.frequency.setValueAtTime(500,context.currentTime+.1),gainNode.gain.setValueAtTime(.15,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.15),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+.15),{oscillator:oscillator,gainNode:gainNode}}}}generateStartupSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="sine",oscillator.frequency.setValueAtTime(200,context.currentTime),oscillator.frequency.exponentialRampToValueAtTime(800,context.currentTime+1),gainNode.gain.setValueAtTime(.1,context.currentTime),gainNode.gain.setValueAtTime(.3,context.currentTime+.5),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+1),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+1),{oscillator:oscillator,gainNode:gainNode}}}}generateShutdownSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="sine",oscillator.frequency.setValueAtTime(800,context.currentTime),oscillator.frequency.exponentialRampToValueAtTime(200,context.currentTime+1),gainNode.gain.setValueAtTime(.3,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+1),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+1),{oscillator:oscillator,gainNode:gainNode}}}}generateDataUpdateSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="square",oscillator.frequency.setValueAtTime(1200,context.currentTime),oscillator.frequency.setValueAtTime(1e3,context.currentTime+.02),gainNode.gain.setValueAtTime(.05,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.05),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+.05),{oscillator:oscillator,gainNode:gainNode}}}}generateWarningSound(){return{type:"generated",generator:(context,destination)=>{const oscillator=context.createOscillator(),gainNode=context.createGain();return oscillator.type="sawtooth",oscillator.frequency.setValueAtTime(660,context.currentTime),oscillator.frequency.setValueAtTime(440,context.currentTime+.2),oscillator.frequency.setValueAtTime(660,context.currentTime+.4),gainNode.gain.setValueAtTime(.25,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.6),oscillator.connect(gainNode),gainNode.connect(destination),oscillator.start(context.currentTime),oscillator.stop(context.currentTime+.6),{oscillator:oscillator,gainNode:gainNode}}}}generateCriticalSound(){return{type:"generated",generator:(context,destination)=>{const oscillator1=context.createOscillator(),oscillator2=context.createOscillator(),gainNode=context.createGain();return oscillator1.type="sawtooth",oscillator1.frequency.setValueAtTime(330,context.currentTime),oscillator2.type="square",oscillator2.frequency.setValueAtTime(165,context.currentTime),gainNode.gain.setValueAtTime(.4,context.currentTime),gainNode.gain.exponentialRampToValueAtTime(.01,context.currentTime+.8),oscillator1.connect(gainNode),oscillator2.connect(gainNode),gainNode.connect(destination),oscillator1.start(context.currentTime),oscillator2.start(context.currentTime),oscillator1.stop(context.currentTime+.8),oscillator2.stop(context.currentTime+.8),{oscillator1:oscillator1,oscillator2:oscillator2,gainNode:gainNode}}}}generateShipHumSound(){return{type:"ambient",generator:(context,destination)=>{const oscillator1=context.createOscillator(),oscillator2=context.createOscillator(),oscillator3=context.createOscillator(),gainNode=context.createGain(),filter=context.createBiquadFilter();return oscillator1.type="sine",oscillator1.frequency.setValueAtTime(60,context.currentTime),oscillator2.type="sine",oscillator2.frequency.setValueAtTime(120,context.currentTime),oscillator3.type="sine",oscillator3.frequency.setValueAtTime(180,context.currentTime),filter.type="lowpass",filter.frequency.setValueAtTime(200,context.currentTime),filter.Q.setValueAtTime(1,context.currentTime),gainNode.gain.setValueAtTime(.1,context.currentTime),oscillator1.connect(filter),oscillator2.connect(filter),oscillator3.connect(filter),filter.connect(gainNode),gainNode.connect(destination),oscillator1.start(context.currentTime),oscillator2.start(context.currentTime),oscillator3.start(context.currentTime),{oscillators:[oscillator1,oscillator2,oscillator3],gainNode:gainNode,filter:filter,stop:()=>{oscillator1.stop(),oscillator2.stop(),oscillator3.stop()}}}}}generateComputerProcessingSound(){return{type:"ambient",generator:(context,destination)=>{const noiseBuffer=this.createNoiseBuffer(context,2),noiseSource=context.createBufferSource(),filter=context.createBiquadFilter(),gainNode=context.createGain();return noiseSource.buffer=noiseBuffer,noiseSource.loop=!0,filter.type="bandpass",filter.frequency.setValueAtTime(2e3,context.currentTime),filter.Q.setValueAtTime(10,context.currentTime),gainNode.gain.setValueAtTime(.02,context.currentTime),noiseSource.connect(filter),filter.connect(gainNode),gainNode.connect(destination),noiseSource.start(context.currentTime),{noiseSource:noiseSource,filter:filter,gainNode:gainNode,stop:()=>noiseSource.stop()}}}}generateVentilationSound(){return{type:"ambient",generator:(context,destination)=>{const noiseBuffer=this.createNoiseBuffer(context,4),noiseSource=context.createBufferSource(),filter=context.createBiquadFilter(),gainNode=context.createGain();return noiseSource.buffer=noiseBuffer,noiseSource.loop=!0,filter.type="lowpass",filter.frequency.setValueAtTime(800,context.currentTime),filter.Q.setValueAtTime(.5,context.currentTime),gainNode.gain.setValueAtTime(.05,context.currentTime),noiseSource.connect(filter),filter.connect(gainNode),gainNode.connect(destination),noiseSource.start(context.currentTime),{noiseSource:noiseSource,filter:filter,gainNode:gainNode,stop:()=>noiseSource.stop()}}}}generateTapeChatterSound(){return{type:"ambient",generator:(context,destination)=>{const bufferSize=2*context.sampleRate,buffer=context.createBuffer(1,bufferSize,context.sampleRate),data=buffer.getChannelData(0);for(let i=0;i<bufferSize;i++)Math.random()<.005?data[i]=.5*Math.random():data[i]=0;const source=context.createBufferSource();source.buffer=buffer,source.loop=!0;const filter=context.createBiquadFilter();filter.type="highpass",filter.frequency.value=2e3;const gainNode=context.createGain();gainNode.gain.value=.15;const lfo=context.createOscillator();lfo.type="square",lfo.frequency.value=2;const lfoGain=context.createGain();return lfoGain.gain.value=.5,lfo.connect(lfoGain),lfoGain.connect(gainNode.gain),lfo.start(),source.connect(filter),filter.connect(gainNode),gainNode.connect(destination),source.start(),{source:source,gainNode:gainNode,stop:()=>{source.stop(),lfo.stop()}}}}}createNoiseBuffer(context,duration){const sampleRate=context.sampleRate,bufferSize=sampleRate*duration,buffer=context.createBuffer(1,bufferSize,sampleRate),data=buffer.getChannelData(0);for(let i=0;i<bufferSize;i++)data[i]=2*Math.random()-1;return buffer}playSound(soundName,volume=1){if(!this.isEnabled||this.isMuted||!this.isInitialized)return;const sound=this.loadedSounds.get(soundName);if(sound)try{if("generated"===sound.type){const nodes=sound.generator(this.audioContext,this.effectsGainNode);if(nodes.gainNode&&1!==volume){const currentGain=nodes.gainNode.gain.value;nodes.gainNode.gain.setValueAtTime(currentGain*volume,this.audioContext.currentTime)}}}catch(error){console.warn(`Failed to play sound '${soundName}':`,error)}else console.warn(`Sound '${soundName}' not found`)}startAmbientAudio(){this.isEnabled&&!this.isMuted&&this.isInitialized&&(this.startAmbientTrack("ship-hum"),this.scheduleRandomComputerSounds(),setTimeout(()=>{this.startAmbientTrack("ventilation")},2e3))}startAmbientTrack(trackName){if(this.ambientSources.has(trackName))return;const sound=this.loadedSounds.get(trackName);if(sound&&"ambient"===sound.type)try{const nodes=sound.generator(this.audioContext,this.ambientGainNode);this.ambientSources.set(trackName,nodes)}catch(error){console.warn(`Failed to start ambient track '${trackName}':`,error)}}stopAmbientTrack(trackName){const source=this.ambientSources.get(trackName);source&&source.stop&&(source.stop(),this.ambientSources.delete(trackName))}scheduleRandomComputerSounds(){if(!this.isEnabled||this.isMuted)return;const playRandomSound=()=>{Math.random()<.3&&this.playSound("data-update",.3);const nextDelay=3e3+7e3*Math.random();setTimeout(playRandomSound,nextDelay)};setTimeout(playRandomSound,5e3)}toggleMute(){return this.isMuted=!this.isMuted,this.masterGainNode&&this.masterGainNode.gain.setValueAtTime(this.isMuted?0:this.masterVolume,this.audioContext.currentTime),this.updateAudioControls(),this.playSound("confirm"),this.isMuted}setMasterVolume(volume){this.masterVolume=Math.max(0,Math.min(1,volume)),this.masterGainNode&&!this.isMuted&&this.masterGainNode.gain.setValueAtTime(this.masterVolume,this.audioContext.currentTime)}setAmbientVolume(volume){this.ambientVolume=Math.max(0,Math.min(1,volume)),this.ambientGainNode&&this.ambientGainNode.gain.setValueAtTime(this.ambientVolume,this.audioContext.currentTime)}setEffectsVolume(volume){this.effectsVolume=Math.max(0,Math.min(1,volume)),this.effectsGainNode&&this.effectsGainNode.gain.setValueAtTime(this.effectsVolume,this.audioContext.currentTime)}setupAudioControls(){const audioToggle=document.getElementById("audio-toggle");audioToggle&&(audioToggle.addEventListener("click",()=>{this.toggleMute()}),this.updateAudioControls())}updateAudioControls(){const audioToggle=document.getElementById("audio-toggle");if(audioToggle){const statusText=this.isMuted?"MUTED":"ON";audioToggle.textContent=`[F8] AUDIO: ${statusText}`,audioToggle.classList.toggle("muted",this.isMuted)}}playKeypress(){this.playSound("keypress",.5)}playBeep(){this.playSound("beep")}playNavigation(){this.playSound("navigation")}playAlert(){this.playSound("alert")}playError(){this.playSound("error")}playConfirm(){this.playSound("confirm")}playWarning(){this.playSound("warning")}playCritical(){this.playSound("critical")}playSystemBoot(){this.playSound("startup")}playSystemLoad(){this.playSound("beep",.3)}destroy(){for(const[trackName]of this.ambientSources)this.stopAmbientTrack(trackName);this.audioContext&&this.audioContext.close(),this.isInitialized=!1,console.log("Nostromo Audio Manager destroyed")}}window.NostromoAudioManager=NostromoAudioManager;