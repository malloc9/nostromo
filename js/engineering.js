class NostromoEngineering{constructor(dataSimulator){this.dataSimulator=dataSimulator,this.refreshInterval=null,this.refreshRate=2e3,this.isActive=!1,this.historicalData=[],this.maxHistoryLength=20,this.powerSystems=this.initializePowerSystems(),this.alertThresholds=this.initializeAlertThresholds(),this.init()}init(){console.log("Engineering system initialized")}initializePowerSystems(){return[{id:"LIFE_SUPPORT",name:"LIFE SUPPORT",baseConsumption:25,priority:"CRITICAL",status:"OPERATIONAL"},{id:"NAVIGATION",name:"NAVIGATION",baseConsumption:15,priority:"HIGH",status:"OPERATIONAL"},{id:"PROPULSION",name:"PROPULSION",baseConsumption:20,priority:"HIGH",status:"OPERATIONAL"},{id:"COMMUNICATIONS",name:"COMMUNICATIONS",baseConsumption:8,priority:"MEDIUM",status:"OPERATIONAL"},{id:"LIGHTING",name:"LIGHTING",baseConsumption:12,priority:"MEDIUM",status:"OPERATIONAL"},{id:"COMPUTER",name:"COMPUTER CORE",baseConsumption:18,priority:"HIGH",status:"OPERATIONAL"},{id:"ARTIFICIAL_GRAVITY",name:"ARTIFICIAL GRAVITY",baseConsumption:22,priority:"CRITICAL",status:"OPERATIONAL"}]}initializeAlertThresholds(){return{generation:{warning:70,critical:50},consumption:{warning:85,critical:95},efficiency:{warning:75,critical:60},fuel:{warning:25,critical:10},netPower:{warning:10,critical:0}}}activate(){this.isActive=!0,this.render(),this.startRealTimeUpdates(),console.log("Engineering system activated")}deactivate(){this.isActive=!1,this.stopRealTimeUpdates(),console.log("Engineering system deactivated")}startRealTimeUpdates(){this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=setInterval(()=>{this.isActive&&this.updateData()},this.refreshRate)}stopRealTimeUpdates(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}render(){const engineeringScreen=document.getElementById("engineering-screen");if(!engineeringScreen)return void console.error("Engineering screen element not found");const screenContent=engineeringScreen.querySelector(".screen-content");screenContent?(screenContent.innerHTML=this.generateEngineeringHTML(),this.updateData()):console.error("Engineering screen content not found")}generateEngineeringHTML(){return`\n            <div class="engineering-container">\n                \x3c!-- Power Generation Overview --\x3e\n                <div class="power-overview-section">\n                    <div class="section-header">POWER GENERATION & DISTRIBUTION</div>\n                    <div class="power-metrics-grid">\n                        <div class="power-metric" id="generation-metric">\n                            <div class="metric-header">\n                                <span class="metric-title">GENERATION</span>\n                                <span class="metric-status" id="generation-status">●</span>\n                            </div>\n                            <div class="metric-display">\n                                <div class="metric-value" id="generation-value">--.--%</div>\n                                <div class="metric-bar" id="generation-bar"></div>\n                            </div>\n                        </div>\n\n                        <div class="power-metric" id="consumption-metric">\n                            <div class="metric-header">\n                                <span class="metric-title">CONSUMPTION</span>\n                                <span class="metric-status" id="consumption-status">●</span>\n                            </div>\n                            <div class="metric-display">\n                                <div class="metric-value" id="consumption-value">--.--%</div>\n                                <div class="metric-bar" id="consumption-bar"></div>\n                            </div>\n                        </div>\n\n                        <div class="power-metric" id="efficiency-metric">\n                            <div class="metric-header">\n                                <span class="metric-title">EFFICIENCY</span>\n                                <span class="metric-status" id="efficiency-status">●</span>\n                            </div>\n                            <div class="metric-display">\n                                <div class="metric-value" id="efficiency-value">--.--%</div>\n                                <div class="metric-bar" id="efficiency-bar"></div>\n                            </div>\n                        </div>\n\n                        <div class="power-metric" id="fuel-metric">\n                            <div class="metric-header">\n                                <span class="metric-title">FUEL LEVEL</span>\n                                <span class="metric-status" id="fuel-status">●</span>\n                            </div>\n                            <div class="metric-display">\n                                <div class="metric-value" id="fuel-value">--.--%</div>\n                                <div class="metric-bar" id="fuel-bar"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Power Distribution Diagram --\x3e\n                <div class="power-diagram-section">\n                    <div class="section-header">POWER DISTRIBUTION GRID</div>\n                    <div class="power-diagram" id="power-diagram">\n                        ${this.generatePowerDiagram()}\n                    </div>\n                </div>\n\n                \x3c!-- System Power Consumption --\x3e\n                <div class="system-consumption-section">\n                    <div class="section-header">SYSTEM POWER CONSUMPTION</div>\n                    <div class="consumption-grid" id="consumption-grid">\n                        ${this.generateConsumptionGrid()}\n                    </div>\n                </div>\n\n                \x3c!-- Power Status Summary --\x3e\n                <div class="power-summary-section">\n                    <div class="section-header">POWER STATUS SUMMARY</div>\n                    <div class="summary-display" id="power-summary">\n                        <div class="summary-item">\n                            <span class="summary-label">NET POWER:</span>\n                            <span class="summary-value" id="net-power-value">+--.--%</span>\n                        </div>\n                        <div class="summary-item">\n                            <span class="summary-label">GRID STATUS:</span>\n                            <span class="summary-value" id="grid-status">STABLE</span>\n                        </div>\n                        <div class="summary-item">\n                            <span class="summary-label">LAST UPDATE:</span>\n                            <span class="summary-value" id="power-last-update">--:--:--</span>\n                        </div>\n                        <div class="summary-item">\n                            <span class="summary-label">ALERTS:</span>\n                            <span class="summary-value" id="power-alert-count">0</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}generatePowerDiagram(){return'\n            <pre class="power-grid-ascii">\n                    POWER GENERATION CORE\n                         ╔═══════════╗\n                         ║ ████████  ║\n                         ║ REACTOR   ║\n                         ║ ████████  ║\n                         ╚═════╤═════╝\n                               │\n                    ┌──────────┼──────────┐\n                    │          │          │\n              ╔═════▼═════╗    │    ╔═════▼═════╗\n              ║ BACKUP    ║    │    ║ AUXILIARY ║\n              ║ GENERATOR ║    │    ║ POWER     ║\n              ╚═════╤═════╝    │    ╚═════╤═════╝\n                    │          │          │\n                    └──────────┼──────────┘\n                               │\n                    ╔══════════▼══════════╗\n                    ║   MAIN POWER BUS    ║\n                    ╚══╤══╤══╤══╤══╤══╤══╝\n                       │  │  │  │  │  │\n                 ┌─────┘  │  │  │  │  └─────┐\n                 │        │  │  │  │        │\n            <span class="system-node" id="node-life-support">LS</span>       <span class="system-node" id="node-navigation">NAV</span> <span class="system-node" id="node-propulsion">PROP</span> <span class="system-node" id="node-computer">COMP</span>      <span class="system-node" id="node-gravity">GRAV</span>\n                 │        │  │  │  │        │\n            LIFE SUPP  NAV PROP COMP    ARTIF GRAV\n                 │        │  │  │  │        │\n            <span class="power-flow" id="flow-life-support">████</span>     <span class="power-flow" id="flow-navigation">███</span> <span class="power-flow" id="flow-propulsion">████</span> <span class="power-flow" id="flow-computer">███</span>     <span class="power-flow" id="flow-gravity">████</span>\n                 │        │  │  │  │        │\n                 └────────┼──┼──┼──┼────────┘\n                          │  │  │  │\n                     ┌────┘  │  │  └────┐\n                     │       │  │       │\n                <span class="system-node" id="node-communications">COMM</span>    <span class="system-node" id="node-lighting">LIGHT</span>    <span class="system-node" id="node-other">OTHER</span>\n                     │       │  │       │\n                COMMUNIC  LIGHTING   OTHER SYS\n                     │       │  │       │\n                <span class="power-flow" id="flow-communications">██</span>      <span class="power-flow" id="flow-lighting">███</span>      <span class="power-flow" id="flow-other">██</span>\n            </pre>\n        '}generateConsumptionGrid(){return this.powerSystems.map(system=>`\n            <div class="consumption-item" id="consumption-${system.id.toLowerCase()}">\n                <div class="system-info">\n                    <div class="system-name">${system.name}</div>\n                    <div class="system-priority priority-${system.priority.toLowerCase()}">${system.priority}</div>\n                </div>\n                <div class="consumption-display">\n                    <div class="consumption-value" id="consumption-value-${system.id.toLowerCase()}">--%</div>\n                    <div class="consumption-bar" id="consumption-bar-${system.id.toLowerCase()}"></div>\n                </div>\n                <div class="system-status">\n                    <span class="status-indicator" id="status-${system.id.toLowerCase()}">●</span>\n                    <span class="status-text" id="status-text-${system.id.toLowerCase()}">${system.status}</span>\n                </div>\n            </div>\n        `).join("")}updateData(){if(!this.dataSimulator)return void console.warn("Data simulator not available");const powerData=this.dataSimulator.generateSystemStatus().power;this.storeHistoricalData(powerData),this.updatePowerMetrics(powerData),this.updatePowerDiagram(powerData),this.updateSystemConsumption(powerData),this.updatePowerSummary(powerData)}storeHistoricalData(data){const timestamp=Date.now();this.historicalData.push({timestamp:timestamp,...data}),this.historicalData.length>this.maxHistoryLength&&this.historicalData.shift()}updatePowerMetrics(powerData){this.updatePowerMetric("generation",powerData.generation,"%",0,100),this.updatePowerMetric("consumption",powerData.consumption,"%",0,100),this.updatePowerMetric("efficiency",powerData.efficiency,"%",0,100),this.updatePowerMetric("fuel",powerData.fuel,"%",0,100)}updatePowerMetric(metric,value,unit,min,max){const valueElement=document.getElementById(`${metric}-value`),statusElement=document.getElementById(`${metric}-status`),barElement=document.getElementById(`${metric}-bar`);if(!valueElement||!statusElement||!barElement)return;valueElement.textContent=`${value.toFixed(1)}${unit}`;const status=this.getPowerMetricStatus(metric,value);statusElement.className=`metric-status ${status}`;const percentage=(value-min)/(max-min)*100;barElement.innerHTML=this.generateASCIIBar(percentage,status)}getPowerMetricStatus(metric,value){const thresholds=this.alertThresholds[metric];if(!thresholds)return"status-ok";switch(metric){case"generation":case"efficiency":case"fuel":return value<thresholds.critical?"status-critical":value<thresholds.warning?"status-warning":"status-ok";case"consumption":return value>thresholds.critical?"status-critical":value>thresholds.warning?"status-warning":"status-ok";default:return"status-ok"}}generateASCIIBar(percentage,status){const filledBars=Math.round(percentage/100*20),emptyBars=20-filledBars;return`\n            <div class="ascii-bar ${status}">\n                <span class="bar-filled">${"█".repeat(filledBars)}</span><span class="bar-empty">${"░".repeat(emptyBars)}</span>\n                <span class="bar-percentage">${percentage.toFixed(1)}%</span>\n            </div>\n        `}updatePowerDiagram(powerData){this.powerSystems.forEach(system=>{const nodeElement=document.getElementById(`node-${system.id.toLowerCase().replace("_","-")}`),flowElement=document.getElementById(`flow-${system.id.toLowerCase().replace("_","-")}`);if(nodeElement){const systemConsumption=this.calculateSystemConsumption(system,powerData),status=this.getSystemPowerStatus(systemConsumption);nodeElement.className=`system-node ${status}`}if(flowElement){const systemConsumption=this.calculateSystemConsumption(system,powerData),flowIntensity=Math.round(systemConsumption/30*4),flowChars="█".repeat(Math.max(1,flowIntensity))+"░".repeat(Math.max(0,4-flowIntensity));flowElement.textContent=flowChars;const status=this.getSystemPowerStatus(systemConsumption);flowElement.className=`power-flow ${status}`}})}calculateSystemConsumption(system,powerData){const variation=(powerData.consumption-72)/72,systemConsumption=system.baseConsumption*(1+.2*variation),fluctuation=.1*(Math.random()-.5);return Math.max(0,systemConsumption*(1+fluctuation))}getSystemPowerStatus(consumption){return consumption>25?"status-critical":consumption>20?"status-warning":"status-ok"}updateSystemConsumption(powerData){this.powerSystems.forEach(system=>{const consumption=this.calculateSystemConsumption(system,powerData),valueElement=document.getElementById(`consumption-value-${system.id.toLowerCase()}`);valueElement&&(valueElement.textContent=`${consumption.toFixed(1)}%`);const barElement=document.getElementById(`consumption-bar-${system.id.toLowerCase()}`);if(barElement){const status=this.getSystemPowerStatus(consumption),percentage=consumption/30*100;barElement.innerHTML=this.generateASCIIBar(percentage,status)}const statusElement=document.getElementById(`status-${system.id.toLowerCase()}`),statusTextElement=document.getElementById(`status-text-${system.id.toLowerCase()}`);if(statusElement&&statusTextElement){const status=this.getSystemPowerStatus(consumption);statusElement.className=`status-indicator ${status}`;let statusText="OPERATIONAL";"status-warning"===status&&(statusText="HIGH LOAD"),"status-critical"===status&&(statusText="OVERLOAD"),statusTextElement.textContent=statusText}})}updatePowerSummary(powerData){const netPowerElement=document.getElementById("net-power-value");if(netPowerElement){const netPower=powerData.generation-powerData.consumption,sign=netPower>=0?"+":"";netPowerElement.textContent=`${sign}${netPower.toFixed(1)}%`;const status=this.getPowerMetricStatus("netPower",netPower);netPowerElement.className=`summary-value ${status}`}const gridStatusElement=document.getElementById("grid-status");if(gridStatusElement){const netPower=powerData.generation-powerData.consumption;let gridStatus="STABLE",statusClass="status-ok";netPower<0?(gridStatus="CRITICAL",statusClass="status-critical"):netPower<10&&(gridStatus="UNSTABLE",statusClass="status-warning"),gridStatusElement.textContent=gridStatus,gridStatusElement.className=`summary-value ${statusClass}`}const lastUpdateElement=document.getElementById("power-last-update");if(lastUpdateElement){const now=new Date;lastUpdateElement.textContent=now.toTimeString().substring(0,8)}const alertCountElement=document.getElementById("power-alert-count");if(alertCountElement){const alerts=this.calculatePowerAlerts(powerData);alertCountElement.textContent=alerts.toString(),alertCountElement.className="summary-value "+(alerts>0?"status-warning":"status-ok")}}calculatePowerAlerts(powerData){let alerts=0;(powerData.generation<this.alertThresholds.generation.critical||powerData.generation<this.alertThresholds.generation.warning)&&alerts++,(powerData.consumption>this.alertThresholds.consumption.critical||powerData.consumption>this.alertThresholds.consumption.warning)&&alerts++,(powerData.efficiency<this.alertThresholds.efficiency.critical||powerData.efficiency<this.alertThresholds.efficiency.warning)&&alerts++,(powerData.fuel<this.alertThresholds.fuel.critical||powerData.fuel<this.alertThresholds.fuel.warning)&&alerts++;const netPower=powerData.generation-powerData.consumption;return(netPower<=this.alertThresholds.netPower.critical||netPower<=this.alertThresholds.netPower.warning)&&alerts++,alerts}getCurrentPowerData(){return this.dataSimulator?this.dataSimulator.generateSystemStatus().power:null}validatePowerCalculations(powerData){const errors=[];("number"!=typeof powerData.generation||powerData.generation<0||powerData.generation>100)&&errors.push("Invalid power generation value"),("number"!=typeof powerData.consumption||powerData.consumption<0||powerData.consumption>100)&&errors.push("Invalid power consumption value"),("number"!=typeof powerData.efficiency||powerData.efficiency<0||powerData.efficiency>100)&&errors.push("Invalid power efficiency value"),("number"!=typeof powerData.fuel||powerData.fuel<0||powerData.fuel>100)&&errors.push("Invalid fuel level value");const calculatedNetPower=powerData.generation-powerData.consumption;return void 0!==powerData.netPower&&Math.abs(powerData.netPower-calculatedNetPower)>.1&&errors.push("Net power calculation mismatch"),errors}}"undefined"!=typeof module&&module.exports?module.exports=NostromoEngineering:window.NostromoEngineering=NostromoEngineering;